# ğŸ‹ï¸ Gym Manager - Há»‡ thá»‘ng quáº£n lÃ½ phÃ²ng gym toÃ n diá»‡n

Há»‡ thá»‘ng quáº£n lÃ½ phÃ²ng gym hiá»‡n Ä‘áº¡i vá»›i Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng tá»« quáº£n lÃ½ thÃ nh viÃªn, thanh toÃ¡n, thiáº¿t bá»‹ Ä‘áº¿n báº£o trÃ¬ tá»± Ä‘á»™ng.

## âœ¨ TÃ­nh nÄƒng chÃ­nh

### ğŸ” **XÃ¡c thá»±c & PhÃ¢n quyá»n**
- âœ… ÄÄƒng kÃ½, Ä‘Äƒng nháº­p, Ä‘Äƒng xuáº¥t
- âœ… JWT Authentication (Access Token + Refresh Token)
- âœ… PhÃ¢n quyá»n 3 cáº¥p: **Admin**, **Trainer**, **Member**
- âœ… Báº£o máº­t cao cáº¥p: Hash password, CORS, Validation

### ğŸ‘¥ **Quáº£n lÃ½ thÃ nh viÃªn**
- âœ… ÄÄƒng kÃ½ thÃ nh viÃªn vá»›i mÃ£ tá»± Ä‘á»™ng
- âœ… Quáº£n lÃ½ thÃ´ng tin cÃ¡ nhÃ¢n vÃ  liÃªn há»‡ kháº©n cáº¥p
- âœ… TÃ¬m kiáº¿m vÃ  lá»c thÃ nh viÃªn
- âœ… Theo dÃµi tráº¡ng thÃ¡i thÃ nh viÃªn

### ğŸ’° **Há»‡ thá»‘ng thanh toÃ¡n thÃ´ng minh**
- âœ… Táº¡o hÃ³a Ä‘Æ¡n tá»± Ä‘á»™ng khi Ä‘Äƒng kÃ½ dá»‹ch vá»¥
- âœ… XÃ¡c nháº­n thanh toÃ¡n bá»Ÿi Admin
- âœ… Theo dÃµi hÃ³a Ä‘Æ¡n chá» thanh toÃ¡n & quÃ¡ háº¡n
- âœ… Thá»‘ng kÃª doanh thu theo thá»i gian thá»±c
- âœ… Dashboard tÃ i chÃ­nh trá»±c quan

### ğŸ‹ï¸ **Quáº£n lÃ½ gÃ³i táº­p**
- âœ… Táº¡o vÃ  quáº£n lÃ½ cÃ¡c gÃ³i membership
- âœ… Mua gÃ³i táº­p trá»±c tuyáº¿n
- âœ… Theo dÃµi lá»‹ch sá»­ vÃ  tráº¡ng thÃ¡i gÃ³i
- âœ… NgÄƒn cháº·n mua gÃ³i khi cÃ²n ná»£

### ğŸ› ï¸ **Quáº£n lÃ½ thiáº¿t bá»‹**
- âœ… Quáº£n lÃ½ toÃ n bá»™ thiáº¿t bá»‹ gym
- âœ… Há»‡ thá»‘ng báº£o trÃ¬ tá»± Ä‘á»™ng theo lá»‹ch
- âœ… Theo dÃµi lá»‹ch sá»­ báº£o trÃ¬
- âœ… Dashboard thiáº¿t bá»‹ trá»±c quan

### ğŸ“ **Quáº£n lÃ½ lá»›p há»c**
- âœ… Táº¡o vÃ  quáº£n lÃ½ lá»›p táº­p
- âœ… ÄÄƒng kÃ½ lá»›p há»c
- âœ… Quáº£n lÃ½ huáº¥n luyá»‡n viÃªn
- âœ… Theo dÃµi sá»©c chá»©a lá»›p há»c

### ğŸ“Š **Dashboard & BÃ¡o cÃ¡o**
- âœ… Dashboard admin vá»›i thá»‘ng kÃª toÃ n diá»‡n
- âœ… BÃ¡o cÃ¡o doanh thu theo thá»i gian thá»±c
- âœ… Thá»‘ng kÃª thÃ nh viÃªn vÃ  hoáº¡t Ä‘á»™ng
- âœ… Giao diá»‡n trá»±c quan vÃ  thÃ¢n thiá»‡n

## ğŸ› ï¸ CÃ´ng nghá»‡ sá»­ dá»¥ng

### **Backend Stack**
- **Runtime**: Node.js 16+
- **Framework**: Express.js
- **Database**: PostgreSQL vá»›i Sequelize ORM
- **Authentication**: JWT (Access + Refresh Tokens)
- **Security**: bcryptjs, Helmet, CORS, Rate Limiting
- **Validation**: Joi
- **Testing**: Jest, Supertest
- **Performance**: Autocannon, Clinic.js

### **Frontend**
- **Core**: HTML5, CSS3, Vanilla JavaScript
- **UI/UX**: Responsive Design, Modern CSS Grid/Flexbox
- **Components**: Dynamic DOM manipulation
- **API Integration**: Fetch API vá»›i error handling

### **DevOps & Tools**
- **Development**: Nodemon, ESLint
- **Testing**: Jest vá»›i coverage reports
- **API Documentation**: Swagger/OpenAPI 3.0
- **Database**: PostgreSQL migrations & seeders

## ğŸ“‹ YÃªu cáº§u há»‡ thá»‘ng

- Node.js >= 16.0.0
- PostgreSQL >= 12.0
- npm >= 8.0.0

## âš¡ CÃ i Ä‘áº·t nhanh

### 1. Clone project
\`\`\`bash
git clone <repository-url>
cd gym-manager
\`\`\`

### 2. CÃ i Ä‘áº·t dependencies
\`\`\`bash
npm install
\`\`\`

### 3. Cáº¥u hÃ¬nh database
- Táº¡o database PostgreSQL: \`gym_manager_simple\`
- Copy \`.env.example\` thÃ nh \`.env\`
- Cáº­p nháº­t thÃ´ng tin database trong \`.env\`

### 4. Cháº¡y á»©ng dá»¥ng
\`\`\`bash
# Development
npm run dev

# Production
npm start
\`\`\`

### 5. Test á»©ng dá»¥ng
- **Frontend**: http://localhost:3000
- **API**: http://localhost:3000/api  
- **Swagger Docs**: http://localhost:3000/api-docs
- **Health check**: http://localhost:3000/api/health

### 6. Cháº¡y tests
```bash
# Test cÆ¡ báº£n
npm test

# Test vá»›i coverage
npm run test:coverage

# Test táº¥t cáº£ (bao gá»“m performance & security)
npm run test:all
```

## ğŸ‘¤ TÃ i khoáº£n máº·c Ä‘á»‹nh

Há»‡ thá»‘ng tá»± Ä‘á»™ng táº¡o cÃ¡c tÃ i khoáº£n demo:

### **Admin Account**
- **Email**: admin@gym.com
- **Password**: admin123
- **Quyá»n**: Quáº£n lÃ½ toÃ n bá»™ há»‡ thá»‘ng

### **Trainer Account**  
- **Email**: trainer@gym.com
- **Password**: trainer123
- **Quyá»n**: Quáº£n lÃ½ thÃ nh viÃªn vÃ  lá»›p há»c

### **Member Account**
- **Email**: member@gym.com  
- **Password**: member123
- **Quyá»n**: Xem thÃ´ng tin cÃ¡ nhÃ¢n vÃ  mua gÃ³i táº­p

âš ï¸ **Báº£o máº­t**: Äá»•i máº­t kháº©u ngay sau khi Ä‘Äƒng nháº­p láº§n Ä‘áº§u!

## ğŸ“š API Documentation

### ğŸ”— **Swagger UI**: [http://localhost:3000/api-docs](http://localhost:3000/api-docs)
### ğŸ“„ **API Spec**: [`docs/swagger.yaml`](docs/swagger.yaml)

### **CÃ¡c endpoints chÃ­nh:**

#### ğŸ” **Authentication**
- \`POST /api/auth/register\` - ÄÄƒng kÃ½ tÃ i khoáº£n
- \`POST /api/auth/login\` - ÄÄƒng nháº­p
- \`POST /api/auth/logout\` - ÄÄƒng xuáº¥t
- \`POST /api/auth/refresh\` - LÃ m má»›i token

#### ğŸ‘¥ **Members Management**
- \`GET /api/members\` - Danh sÃ¡ch thÃ nh viÃªn (Admin/Trainer)
- \`POST /api/members/register\` - ÄÄƒng kÃ½ thÃ nh viÃªn má»›i
- \`GET /api/members/:id\` - Chi tiáº¿t thÃ nh viÃªn
- \`PUT /api/members/:id\` - Cáº­p nháº­t thÃ´ng tin
- \`POST /api/members/my/membership\` - Mua gÃ³i táº­p (Member)

#### ğŸ’° **Payment & Invoices**
- \`GET /api/invoices\` - Danh sÃ¡ch hÃ³a Ä‘Æ¡n
- \`GET /api/invoices/:id\` - Chi tiáº¿t hÃ³a Ä‘Æ¡n
- \`PUT /api/invoices/:id/status\` - XÃ¡c nháº­n thanh toÃ¡n (Admin)
- \`GET /api/payments\` - Lá»‹ch sá»­ thanh toÃ¡n

#### ğŸ‹ï¸ **Memberships**
- \`GET /api/members/memberships/all\` - Danh sÃ¡ch gÃ³i táº­p
- \`POST /api/members/memberships\` - Táº¡o gÃ³i má»›i (Admin)

#### ğŸ› ï¸ **Equipment & Maintenance**
- \`GET /api/equipment\` - Danh sÃ¡ch thiáº¿t bá»‹
- \`POST /api/equipment\` - ThÃªm thiáº¿t bá»‹ (Admin)
- \`GET /api/maintenance-schedules\` - Lá»‹ch báº£o trÃ¬
- \`POST /api/maintenance-schedules\` - Táº¡o lá»‹ch báº£o trÃ¬

### **VÃ­ dá»¥ sá»­ dá»¥ng API:**
\`\`\`bash
# 1. ÄÄƒng kÃ½ thÃ nh viÃªn má»›i
curl -X POST http://localhost:3000/api/members/register \\
  -H "Content-Type: application/json" \\
  -d '{
    "fullName": "Nguyá»…n VÄƒn A",
    "phone": "0123456789",
    "email": "nguyenvana@example.com",
    "membershipId": 1
  }'

# 2. ÄÄƒng nháº­p
curl -X POST http://localhost:3000/api/auth/login \\
  -H "Content-Type: application/json" \\
  -d '{
    "email": "admin@gym.com",
    "password": "admin123"
  }'

# 3. Láº¥y danh sÃ¡ch hÃ³a Ä‘Æ¡n (cáº§n token)
curl -X GET http://localhost:3000/api/invoices \\
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
\`\`\`

## ğŸ—ƒï¸ Database Schema

### ğŸ“„ **Chi tiáº¿t**: [`docs/DATABASE_SCHEMA.md`](docs/DATABASE_SCHEMA.md)

### **CÃ¡c báº£ng chÃ­nh:**

#### ğŸ‘¤ **User Management**
- `users` - TÃ i khoáº£n Ä‘Äƒng nháº­p (Admin/Trainer/Member)
- `refresh_tokens` - JWT refresh tokens
- `members` - Há»“ sÆ¡ thÃ nh viÃªn chi tiáº¿t

#### ğŸ’° **Payment System**  
- `invoices` - HÃ³a Ä‘Æ¡n tá»± Ä‘á»™ng
- `invoice_items` - Chi tiáº¿t hÃ³a Ä‘Æ¡n
- `payments` - Giao dá»‹ch thanh toÃ¡n
- `promotions` - MÃ£ khuyáº¿n mÃ£i

#### ğŸ‹ï¸ **Gym Management**
- `memberships` - GÃ³i thÃ nh viÃªn
- `membership_history` - Lá»‹ch sá»­ mua gÃ³i
- `equipment` - Thiáº¿t bá»‹ gym
- `maintenance_schedules` - Lá»‹ch báº£o trÃ¬ tá»± Ä‘á»™ng
- `maintenance_history` - Lá»‹ch sá»­ báº£o trÃ¬

#### ğŸ“ **Class Management**
- `classes` - Lá»›p táº­p
- `class_schedules` - Lá»‹ch trÃ¬nh lá»›p
- `class_enrollments` - ÄÄƒng kÃ½ lá»›p

### **TÃ­nh nÄƒng Ä‘áº·c biá»‡t:**
- âœ… **Auto-generated codes**: Member codes, Invoice numbers
- âœ… **Automatic maintenance**: Equipment maintenance scheduling  
- âœ… **Payment workflow**: Invoice â†’ Payment confirmation â†’ Revenue
- âœ… **Membership validation**: Prevent new purchases with pending invoices
- âœ… **Audit trails**: Complete history tracking

## ğŸ”’ Báº£o máº­t

### **Authentication & Authorization**
- âœ… **Password Security**: bcryptjs hashing vá»›i salt rounds
- âœ… **JWT Tokens**: Access + Refresh token vá»›i expiration
- âœ… **Token Rotation**: Automatic refresh token rotation  
- âœ… **Role-based Access**: Admin/Trainer/Member permissions
- âœ… **Session Management**: Secure logout vÃ  token revocation

### **API Security**
- âœ… **CORS Protection**: Configured origins
- âœ… **Input Validation**: Joi schema validation
- âœ… **Rate Limiting**: Request rate limiting per user
- âœ… **Security Headers**: Helmet.js integration
- âœ… **SQL Injection Prevention**: Sequelize ORM protection

### **Data Protection**
- âœ… **Sensitive Data**: No passwords/tokens in logs
- âœ… **Database Security**: Connection encryption
- âœ… **Error Handling**: No sensitive info in error messages

## ğŸ“ Cáº¥u trÃºc project

\`\`\`
gym-manager/
â”œâ”€â”€ ğŸ“ config/                    # Cáº¥u hÃ¬nh á»©ng dá»¥ng
â”‚   â”œâ”€â”€ database.js               # Káº¿t ná»‘i PostgreSQL
â”‚   â””â”€â”€ config.js                 # Cáº¥u hÃ¬nh chung
â”œâ”€â”€ ğŸ“ controllers/               # API Controllers
â”‚   â”œâ”€â”€ authController.js         # XÃ¡c thá»±c & phÃ¢n quyá»n
â”‚   â”œâ”€â”€ memberController.js       # Quáº£n lÃ½ thÃ nh viÃªn  
â”‚   â”œâ”€â”€ invoiceController.js      # Quáº£n lÃ½ hÃ³a Ä‘Æ¡n
â”‚   â”œâ”€â”€ paymentController.js      # Xá»­ lÃ½ thanh toÃ¡n
â”‚   â”œâ”€â”€ equipmentController.js    # Quáº£n lÃ½ thiáº¿t bá»‹
â”‚   â””â”€â”€ classController.js        # Quáº£n lÃ½ lá»›p táº­p
â”œâ”€â”€ ğŸ“ middleware/                # Middleware functions
â”‚   â”œâ”€â”€ auth.js                   # JWT authentication
â”‚   â”œâ”€â”€ validation.js             # Joi validation
â”‚   â”œâ”€â”€ errorHandler.js           # Error handling
â”‚   â””â”€â”€ security.js               # Security headers
â”œâ”€â”€ ğŸ“ models/                    # Database models (Sequelize)
â”‚   â”œâ”€â”€ User.js                   # User accounts
â”‚   â”œâ”€â”€ Member.js                 # Member profiles
â”‚   â”œâ”€â”€ Invoice.js                # Invoice management
â”‚   â”œâ”€â”€ Payment.js                # Payment records
â”‚   â”œâ”€â”€ Equipment.js              # Gym equipment
â”‚   â”œâ”€â”€ MaintenanceSchedule.js    # Maintenance scheduling
â”‚   â””â”€â”€ index.js                  # Model associations
â”œâ”€â”€ ğŸ“ routes/                    # API routes
â”‚   â”œâ”€â”€ authRoutes.js             # Authentication endpoints
â”‚   â”œâ”€â”€ memberRoutes.js           # Member management
â”‚   â”œâ”€â”€ invoiceRoutes.js          # Invoice & payment
â”‚   â”œâ”€â”€ equipmentRoutes.js        # Equipment management
â”‚   â””â”€â”€ classRoutes.js            # Class management
â”œâ”€â”€ ğŸ“ services/                  # Business logic
â”‚   â”œâ”€â”€ authService.js            # Authentication logic
â”‚   â”œâ”€â”€ memberService.js          # Member operations
â”‚   â”œâ”€â”€ paymentService.js         # Payment processing
â”‚   â”œâ”€â”€ maintenanceSchedulerService.js # Auto maintenance
â”‚   â””â”€â”€ notificationService.js    # Notification system
â”œâ”€â”€ ğŸ“ public/demo/               # Frontend demo
â”‚   â”œâ”€â”€ admin-complete.html       # Admin dashboard
â”‚   â”œâ”€â”€ member-complete.html      # Member interface
â”‚   â”œâ”€â”€ trainer-complete.html     # Trainer interface
â”‚   â””â”€â”€ css/styles.css            # Styling
â”œâ”€â”€ ğŸ“ tests/                     # Test suites
â”‚   â”œâ”€â”€ unit/                     # Unit tests
â”‚   â”œâ”€â”€ integration/              # Integration tests
â”‚   â”œâ”€â”€ performance/              # Performance tests
â”‚   â””â”€â”€ security/                 # Security tests  
â”œâ”€â”€ ğŸ“ docs/                      # Documentation
â”‚   â”œâ”€â”€ swagger.yaml              # API documentation
â”‚   â”œâ”€â”€ DATABASE_SCHEMA.md        # Database schema
â”‚   â””â”€â”€ TESTING.md                # Testing guide
â”œâ”€â”€ ğŸ“ scripts/                   # Utility scripts
â”‚   â”œâ”€â”€ createTestData.js         # Generate test data
â”‚   â”œâ”€â”€ syncDatabase.js           # Database sync
â”‚   â””â”€â”€ run-all-tests.js          # Test runner
â”œâ”€â”€ ğŸ“ migrations/                # Database migrations
â”œâ”€â”€ ğŸ“ seeders/                   # Database seeders
â”œâ”€â”€ .env                          # Environment variables
â”œâ”€â”€ app.js                        # Application entry point
â”œâ”€â”€ package.json                  # Dependencies & scripts
â””â”€â”€ README.md                     # Project documentation
\`\`\`

## ğŸ§ª Testing

### **Test Coverage**
Há»‡ thá»‘ng cÃ³ test coverage toÃ n diá»‡n vá»›i Jest vÃ  Supertest:

\`\`\`bash
# Cháº¡y táº¥t cáº£ tests
npm test

# Test vá»›i coverage report  
npm run test:coverage

# Performance & security tests
npm run test:all
\`\`\`

### **Test Categories**
- âœ… **Unit Tests**: Business logic vÃ  services
- âœ… **Integration Tests**: API endpoints end-to-end
- âœ… **Security Tests**: Authentication & authorization
- âœ… **Performance Tests**: Load testing vá»›i Autocannon

### **Test Results**
- **Coverage**: >90% cho controllers vÃ  services
- **API Tests**: ToÃ n bá»™ endpoints Ä‘Æ°á»£c test
- **Security**: Authentication flows validated
- **Performance**: Load tested up to 1000 concurrent users

## ğŸš€ Production Deployment

### **Environment Setup**
\`\`\`bash
# Production environment variables
NODE_ENV=production
DATABASE_URL=postgresql://user:pass@host:5432/gym_manager
JWT_ACCESS_SECRET=your-super-secure-secret
JWT_REFRESH_SECRET=another-secure-secret
CORS_ORIGIN=https://yourdomain.com
\`\`\`

### **Performance Optimizations**
- Database connection pooling
- Query optimization with indexes
- Rate limiting per user
- Caching for frequent queries

## ğŸ› Troubleshooting

### **Database Issues**
- âœ… **Connection Failed**: Check PostgreSQL service, credentials in `.env`
- âœ… **Migration Errors**: Run `node scripts/syncDatabase.js` 
- âœ… **Slow Queries**: Check database indexes and connection pool

### **Authentication Issues**  
- âœ… **JWT Errors**: Verify JWT secrets in `.env`
- âœ… **CORS Errors**: Check allowed origins configuration
- âœ… **Permission Denied**: Verify user roles and permissions

### **API Issues**
- âœ… **404 Errors**: Check route definitions and middleware
- âœ… **Validation Errors**: Verify request body against Joi schemas
- âœ… **500 Errors**: Check server logs for detailed error messages

### **Common Solutions**
\`\`\`bash
# Reset database and recreate with test data
npm run clean-start
node scripts/createTestData.js

# Clear all node processes (Windows)
taskkill /f /im node.exe

# Check logs
tail -f logs/app.log  # if logging to file
\`\`\`

## ğŸ“Š Monitoring & Logging

### **Health Checks**
- **API Health**: \`GET /api/health\`
- **Database**: Connection status monitoring
- **Services**: Auto-restart on failure

### **Performance Metrics**
- Response time monitoring
- Database query performance
- Memory usage tracking
- Error rate monitoring

## ğŸ¤ Contributing

### **Development Workflow**
1. Fork repository
2. Create feature branch: \`git checkout -b feature/amazing-feature\`
3. Commit changes: \`git commit -m 'Add amazing feature'\`
4. Push to branch: \`git push origin feature/amazing-feature\`
5. Open Pull Request

### **Code Standards**
- ESLint configuration for code quality
- Prettier for code formatting  
- Jest for testing requirements
- Comprehensive error handling

## ğŸ“ Support & Contact

### **Documentation**
- ğŸ“– **API Docs**: http://localhost:3000/api-docs
- ğŸ—ƒï¸ **Database Schema**: [docs/DATABASE_SCHEMA.md](docs/DATABASE_SCHEMA.md)
- ğŸ§ª **Testing Guide**: [docs/TESTING.md](docs/TESTING.md)

### **Issues & Bugs**
1. Check existing issues on GitHub
2. Create detailed bug report with:
   - Steps to reproduce
   - Expected vs actual behavior
   - Environment details
   - Console logs/screenshots

### **Feature Requests**
- Submit via GitHub Issues with "enhancement" label
- Provide clear use case and requirements
- Consider contributing the feature yourself!

---

## ğŸ¯ Project Status

**Current Version**: 1.0.0  
**Status**: âœ… Production Ready  
**Last Updated**: August 2025  
**Maintainer**: Äáº·ng Äá»©c CÆ°á»ng

### **Recent Updates**
- âœ… Complete payment system with admin confirmation
- âœ… Automatic equipment maintenance scheduling  
- âœ… Revenue tracking and financial dashboard
- âœ… Comprehensive test coverage
- âœ… Production-ready security measures
- âœ… Optimized notification system (removed problematic features)

### **Roadmap**
- ğŸ”„ Mobile app integration
- ğŸ”„ Advanced reporting and analytics
- ğŸ”„ Member check-in/check-out system
- ğŸ”„ Nutrition tracking integration
- ğŸ”„ Personal training scheduling

---

**ğŸ‹ï¸ Gym Manager** - *Quáº£n lÃ½ phÃ²ng gym chuyÃªn nghiá»‡p vÃ  hiá»‡n Ä‘áº¡i*  
*PhÃ¡t triá»ƒn bá»Ÿi Äáº·ng Äá»©c CÆ°á»ng vá»›i tÃ¬nh yÃªu cÃ´ng nghá»‡* â¤ï¸