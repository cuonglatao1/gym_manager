<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Manager - ƒêƒÉng nh·∫≠p</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            width: 100%;
            max-width: 400px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 { font-size: 24px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 14px; }

        .form-container { padding: 30px; }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .toggle-form {
            text-align: center;
            margin-top: 20px;
        }

        .toggle-form a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .user-info {
            display: none;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .user-info h3 { margin-bottom: 15px; color: #333; }
        .user-info p { margin-bottom: 8px; font-size: 14px; }
        .user-info strong { color: #667eea; }

        .logout-btn {
            background: #dc3545;
            margin-top: 15px;
        }

        .form { display: none; }
        .form.active { display: block; }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f5f5f5;
            border-radius: 8px;
            overflow: hidden;
        }

        .tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèãÔ∏è Gym Manager</h1>
            <p>H·ªá th·ªëng qu·∫£n l√Ω ph√≤ng gym</p>
        </div>

        <div class="form-container">
            <div class="tabs">
                <button class="tab active" onclick="showForm('login')">ƒêƒÉng nh·∫≠p</button>
                <button class="tab" onclick="showForm('register')">ƒêƒÉng k√Ω</button>
            </div>

            <div id="message" class="message"></div>

            <!-- Login Form -->
            <form id="loginForm" class="form active">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="Nh·∫≠p email c·ªßa b·∫°n">
                </div>
                <div class="form-group">
                    <label for="loginPassword">M·∫≠t kh·∫©u</label>
                    <input type="password" id="loginPassword" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                </div>
                <button type="submit" class="btn" id="loginBtn">ƒêƒÉng nh·∫≠p</button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="form">
                <div class="form-group">
                    <label for="registerUsername">T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="registerUsername" required placeholder="Ch·ªçn t√™n ƒëƒÉng nh·∫≠p">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required placeholder="Nh·∫≠p email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">M·∫≠t kh·∫©u</label>
                    <input type="password" id="registerPassword" required placeholder="T·∫°o m·∫≠t kh·∫©u" minlength="6">
                </div>
                <div class="form-group">
                    <label for="registerFullName">H·ªç v√† t√™n</label>
                    <input type="text" id="registerFullName" placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß">
                </div>
                <div class="form-group">
                    <label for="registerPhone">S·ªë ƒëi·ªán tho·∫°i</label>
                    <input type="tel" id="registerPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                </div>
                <div class="form-group">
                    <label for="registerRole">Vai tr√≤</label>
                    <select id="registerRole" required>
                        <option value="member">H·ªôi vi√™n</option>
                        <option value="trainer">Hu·∫•n luy·ªán vi√™n</option>
                        <option value="admin">Qu·∫£n tr·ªã vi√™n</option>
                    </select>
                </div>
                <button type="submit" class="btn" id="registerBtn">ƒêƒÉng k√Ω</button>
            </form>

            <!-- User Info -->
            <div id="userInfo" class="user-info">
                <h3>Ch√†o m·ª´ng! üëã</h3>
                <p><strong>ID:</strong> <span id="userId"></span></p>
                <p><strong>T√™n ƒëƒÉng nh·∫≠p:</strong> <span id="userUsername"></span></p>
                <p><strong>Email:</strong> <span id="userEmail"></span></p>
                <p><strong>H·ªç t√™n:</strong> <span id="userFullName"></span></p>
                <p><strong>Vai tr√≤:</strong> <span id="userRole"></span></p>
                <div style="margin-top: 15px;">
                    <button onclick="redirectToBusiness()" class="btn" style="margin-bottom: 10px;">üè¢ V√†o ph·∫ßn Business</button>
                    <button onclick="logout()" class="btn logout-btn">ƒêƒÉng xu·∫•t</button>
                </div>
                <p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
                    ƒêang t·ª± ƒë·ªông chuy·ªÉn h∆∞·ªõng sau <span id="countdown">3</span> gi√¢y...
                </p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        let currentTokens = null;

        // Chuy·ªÉn ƒë·ªïi form
        function showForm(formType) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.tab');
            
            hideMessage();
            
            if (formType === 'login') {
                loginForm.classList.add('active');
                registerForm.classList.remove('active');
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                registerForm.classList.add('active');
                loginForm.classList.remove('active');
                tabs[1].classList.add('active');
                tabs[0].classList.remove('active');
            }
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showMessage(message, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = message;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
        }

        function hideMessage() {
            document.getElementById('message').style.display = 'none';
        }

        // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            
            btn.disabled = true;
            btn.textContent = 'ƒêang ƒëƒÉng nh·∫≠p...';
            hideMessage();
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentTokens = {
                        accessToken: data.data.accessToken,
                        refreshToken: data.data.refreshToken
                    };
                    localStorage.setItem('tokens', JSON.stringify(currentTokens));
                    
                    showMessage('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!', 'success');
                    displayUserInfo(data.data.user);
                } else {
                    showMessage(data.message, 'error');
                }
            } catch (error) {
                showMessage('L·ªói k·∫øt n·ªëi server. Vui l√≤ng th·ª≠ l·∫°i!', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ƒêƒÉng nh·∫≠p';
            }
        });

        // X·ª≠ l√Ω ƒëƒÉng k√Ω
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                username: document.getElementById('registerUsername').value,
                email: document.getElementById('registerEmail').value,
                password: document.getElementById('registerPassword').value,
                fullName: document.getElementById('registerFullName').value,
                phone: document.getElementById('registerPhone').value,
                role: document.getElementById('registerRole').value
            };
            
            const btn = document.getElementById('registerBtn');
            btn.disabled = true;
            btn.textContent = 'ƒêang ƒëƒÉng k√Ω...';
            hideMessage();
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentTokens = {
                        accessToken: data.data.accessToken,
                        refreshToken: data.data.refreshToken
                    };
                    localStorage.setItem('tokens', JSON.stringify(currentTokens));
                    
                    showMessage('ƒêƒÉng k√Ω th√†nh c√¥ng!', 'success');
                    displayUserInfo(data.data.user);
                } else {
                    showMessage(data.message, 'error');
                }
            } catch (error) {
                showMessage('L·ªói k·∫øt n·ªëi server. Vui l√≤ng th·ª≠ l·∫°i!', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ƒêƒÉng k√Ω';
            }
        });

        // Hi·ªÉn th·ªã th√¥ng tin user
        function displayUserInfo(user) {
            document.getElementById('userId').textContent = user.id;
            document.getElementById('userUsername').textContent = user.username;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userFullName').textContent = user.fullName || 'Ch∆∞a c·∫≠p nh·∫≠t';
            document.getElementById('userRole').textContent = getRoleText(user.role);
            
            // ·∫®n form, hi·ªán th√¥ng tin user
            document.querySelector('.tabs').style.display = 'none';
            document.querySelector('.form.active').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            
            // B·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c v√† t·ª± ƒë·ªông chuy·ªÉn h∆∞·ªõng
            startCountdown();
        }

        // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang business
        function redirectToBusiness() {
            window.location.href = 'dashboard.html';
        }

        // ƒê·∫øm ng∆∞·ª£c v√† t·ª± ƒë·ªông chuy·ªÉn h∆∞·ªõng
        function startCountdown() {
            let countdown = 3;
            const countdownElement = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    redirectToBusiness();
                }
            }, 1000);
        }

        // Chuy·ªÉn ƒë·ªïi role sang ti·∫øng Vi·ªát
        function getRoleText(role) {
            const roleMap = {
                'admin': 'Qu·∫£n tr·ªã vi√™n',
                'trainer': 'Hu·∫•n luy·ªán vi√™n', 
                'member': 'H·ªôi vi√™n'
            };
            return roleMap[role] || role;
        }

        // ƒêƒÉng xu·∫•t
        async function logout() {
            if (!currentTokens) return;
            
            try {
                await fetch(`${API_BASE_URL}/auth/logout`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ refreshToken: currentTokens.refreshToken })
                });
            } catch (error) {
                console.error('Logout error:', error);
            }
            
            // Clear local data
            currentTokens = null;
            localStorage.removeItem('tokens');
            
            // Reset UI
            document.querySelector('.tabs').style.display = 'flex';
            document.getElementById('userInfo').style.display = 'none';
            showForm('login');
            
            // Clear forms
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();
            
            showMessage('ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!', 'success');
        }

        // T·ª± ƒë·ªông ƒëƒÉng nh·∫≠p n·∫øu c√≥ token
        window.addEventListener('load', async () => {
            const savedTokens = localStorage.getItem('tokens');
            if (savedTokens) {
                try {
                    currentTokens = JSON.parse(savedTokens);
                    
                    // Ki·ªÉm tra token b·∫±ng c√°ch g·ªçi API profile
                    const response = await fetch(`${API_BASE_URL}/auth/me`, {
                        headers: {
                            'Authorization': `Bearer ${currentTokens.accessToken}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        displayUserInfo(data.data);
                        showMessage('ƒê√£ t·ª± ƒë·ªông ƒëƒÉng nh·∫≠p!', 'success');
                    } else {
                        // Token h·∫øt h·∫°n, th·ª≠ refresh
                        await refreshToken();
                    }
                } catch (error) {
                    console.error('Auto login error:', error);
                    localStorage.removeItem('tokens');
                }
            }
        });

        // Refresh token
        async function refreshToken() {
            if (!currentTokens) return false;
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/refresh`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ refreshToken: currentTokens.refreshToken })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentTokens.accessToken = data.data.accessToken;
                    localStorage.setItem('tokens', JSON.stringify(currentTokens));
                    
                    // L·∫•y th√¥ng tin user m·ªõi
                    const userResponse = await fetch(`${API_BASE_URL}/auth/me`, {
                        headers: {
                            'Authorization': `Bearer ${currentTokens.accessToken}`
                        }
                    });
                    
                    if (userResponse.ok) {
                        const userData = await userResponse.json();
                        displayUserInfo(userData.data);
                        return true;
                    }
                }
                
                return false;
            } catch (error) {
                console.error('Refresh token error:', error);
                return false;
            }
        }

        // Test API connection
        async function testConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/me`, {
                    method: 'GET'
                });
                console.log('API connection test:', response.status);
            } catch (error) {
                console.error('API connection failed:', error);
                showMessage('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra server c√≥ ƒëang ch·∫°y kh√¥ng!', 'error');
            }
        }

        // Test k·∫øt n·ªëi khi load trang
        testConnection();
    </script>
</body>
</html>